/**
 * Utility for calculating hash for CVEAffected unique constraint
 *
 * This hash ensures uniqueness even when fields are nullable,
 * avoiding the PostgreSQL NULL != NULL issue in unique constraints.
 */

import crypto from 'crypto'

/**
 * Calculate a deterministic hash for CVEAffected records
 * Used to enforce uniqueness across nullable fields
 *
 * @param vendor - The vendor name (can be null)
 * @param product - The product name (can be null)
 * @param collectionURL - The collection URL (can be null)
 * @param packageName - The package name (can be null)
 * @returns MD5 hash of the combined fields
 */
export function calculateAffectedHash(
    vendor?: string | null,
    product?: string | null,
    collectionURL?: string | null,
    packageName?: string | null
): string {
    // Create a deterministic string representation
    // Use empty string for null/undefined values
    const parts = [
        vendor || '',
        product || '',
        collectionURL || '',
        packageName || ''
    ]

    // Join with a delimiter that won't appear in normal data
    const combined = parts.join('|##|')

    // Return MD5 hash for compact storage
    return crypto.createHash('md5').update(combined).digest('hex')
}