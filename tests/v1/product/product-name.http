###
# Product API Tests - /v1/product/{name}
# Tests for product information by package name
###

# Load shared configuration
< ../../test.config.http

###
# Test 1: Get product information for npm package
GET {{baseUrl}}/{{apiVersion}}/product/express
Authorization: Bearer {{token}}
Content-Type: {{contentType}}

###
# Test 2: Get product with pagination (limit)
GET {{baseUrl}}/{{apiVersion}}/product/express?limit=10
Authorization: Bearer {{token}}
Content-Type: {{contentType}}

###
# Test 3: Get product with offset
GET {{baseUrl}}/{{apiVersion}}/product/express?limit=10&offset=20
Authorization: Bearer {{token}}
Content-Type: {{contentType}}

###
# Test 4: Verify response structure
# @name getProductInfo
GET {{baseUrl}}/{{apiVersion}}/product/react
Authorization: Bearer {{token}}
Content-Type: {{contentType}}

> {%
  client.test("Product info response is valid", function() {
    client.assert(response.status === 200, "Response status is 200");
    client.assert(response.body.packageName !== undefined, "Package name exists");
    client.assert(response.body.timestamp !== undefined, "Timestamp exists");
    client.assert(response.body.total !== undefined, "Total count exists");
    client.assert(response.body.versions !== undefined, "Versions array exists");
    client.assert(Array.isArray(response.body.versions), "Versions is an array");
  });
%}

###
# Test 5: Case insensitive package name
GET {{baseUrl}}/{{apiVersion}}/product/EXPRESS
Authorization: Bearer {{token}}
Content-Type: {{contentType}}

###
# Test 6: Python package (PyPI)
GET {{baseUrl}}/{{apiVersion}}/product/django
Authorization: Bearer {{token}}
Content-Type: {{contentType}}

###
# Test 7: Missing authentication
GET {{baseUrl}}/{{apiVersion}}/product/express
Content-Type: {{contentType}}

> {%
  client.test("Missing auth returns 401", function() {
    client.assert(response.status === 401, "Response status is 401");
  });
%}

###
# Test 8: Production - Get product information
GET {{prodUrl}}/{{apiVersion}}/product/express
Authorization: Bearer {{token}}
Content-Type: {{contentType}}
