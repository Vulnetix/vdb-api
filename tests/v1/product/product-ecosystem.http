###
# Product API Tests - /v1/product/{name}/{version}/{ecosystem}
# Tests for product information by package name, version, and ecosystem
###

# Load shared configuration
< ../../test.config.http

###
# Test 1: Get npm package with version and ecosystem
GET {{baseUrl}}/{{apiVersion}}/product/express/4.18.2/npm
Authorization: Bearer {{token}}
Content-Type: {{contentType}}

###
# Test 2: Get PyPI package with version and ecosystem
GET {{baseUrl}}/{{apiVersion}}/product/django/4.2.0/pypi
Authorization: Bearer {{token}}
Content-Type: {{contentType}}

###
# Test 3: Get Maven package with version and ecosystem
GET {{baseUrl}}/{{apiVersion}}/product/spring-core/5.3.23/maven
Authorization: Bearer {{token}}
Content-Type: {{contentType}}

###
# Test 4: Verify response structure
# @name getProductEcosystem
GET {{baseUrl}}/{{apiVersion}}/product/react/18.2.0/npm
Authorization: Bearer {{token}}
Content-Type: {{contentType}}

> {%
  client.test("Product ecosystem response is valid", function() {
    client.assert(response.status === 200, "Response status is 200");
    client.assert(response.body.packageName !== undefined, "Package name exists");
    client.assert(response.body.version !== undefined, "Version exists");
    client.assert(response.body.ecosystem !== undefined, "Ecosystem exists");
    client.assert(response.body.timestamp !== undefined, "Timestamp exists");
  });
%}

###
# Test 5: Case insensitive ecosystem
GET {{baseUrl}}/{{apiVersion}}/product/express/4.18.2/NPM
Authorization: Bearer {{token}}
Content-Type: {{contentType}}

###
# Test 6: Wrong ecosystem for package
GET {{baseUrl}}/{{apiVersion}}/product/express/4.18.2/pypi
Authorization: Bearer {{token}}
Content-Type: {{contentType}}

###
# Test 7: Missing authentication
GET {{baseUrl}}/{{apiVersion}}/product/express/4.18.2/npm
Content-Type: {{contentType}}

> {%
  client.test("Missing auth returns 401", function() {
    client.assert(response.status === 401, "Response status is 401");
  });
%}

###
# Test 8: Production - Get product ecosystem information
GET {{prodUrl}}/{{apiVersion}}/product/express/4.18.2/npm
Authorization: Bearer {{token}}
Content-Type: {{contentType}}
