###
# CVE Information API Tests - /v1/info
# Tests for CVE metadata and data source information
###

# Load shared configuration
< ../../test.config.http

###
# Test 1: Get CVE information by CVE ID
GET {{baseUrl}}/{{apiVersion}}/info/CVE-2024-1234
Authorization: Bearer {{token}}
Content-Type: {{contentType}}

###
# Test 2: Get CVE information with normalized ID (without CVE- prefix)
GET {{baseUrl}}/{{apiVersion}}/info/2024-1234
Authorization: Bearer {{token}}
Content-Type: {{contentType}}

###
# Test 3: Verify response structure
# @name getCVEInfo
GET {{baseUrl}}/{{apiVersion}}/info/CVE-2024-1234
Authorization: Bearer {{token}}
Content-Type: {{contentType}}

> {%
  client.test("CVE info response is valid", function() {
    client.assert(response.status === 200, "Response status is 200");
    client.assert(response.body._identifier !== undefined, "Identifier exists");
    client.assert(response.body._timestamp !== undefined, "Timestamp exists");
    client.assert(response.body.matched !== undefined, "Matched field exists");
    client.assert(response.body.sources !== undefined, "Sources array exists");
    client.assert(response.body.links !== undefined, "Links array exists");
  });
%}

###
# Test 4: CVE not found
GET {{baseUrl}}/{{apiVersion}}/info/CVE-9999-99999
Authorization: Bearer {{token}}
Content-Type: {{contentType}}

> {%
  client.test("Non-existent CVE returns 404", function() {
    client.assert(response.status === 404, "Response status is 404");
    client.assert(response.body.error !== undefined, "Error message exists");
  });
%}

###
# Test 5: Missing authentication
GET {{baseUrl}}/{{apiVersion}}/info/CVE-2024-1234
Content-Type: {{contentType}}

> {%
  client.test("Missing auth returns 401", function() {
    client.assert(response.status === 401, "Response status is 401");
  });
%}

###
# Test 6: Invalid token
GET {{baseUrl}}/{{apiVersion}}/info/CVE-2024-1234
Authorization: Bearer invalid_token_here
Content-Type: {{contentType}}

> {%
  client.test("Invalid token returns 401", function() {
    client.assert(response.status === 401, "Response status is 401");
  });
%}

###
# Test 7: Get high-profile CVE (Log4Shell)
GET {{baseUrl}}/{{apiVersion}}/info/CVE-2021-44228
Authorization: Bearer {{token}}
Content-Type: {{contentType}}

###
# Test 8: Production - Get CVE information
GET {{prodUrl}}/{{apiVersion}}/info/CVE-2024-1234
Authorization: Bearer {{token}}
Content-Type: {{contentType}}
