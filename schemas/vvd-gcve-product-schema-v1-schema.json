{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://vulnetix.com/schemas/vvd-gcve-product-schema-v1-schema.json",
  "title": "VVD Product/Package Response Schema",
  "description": "Normalized product/package response with versions and sources across all data sources",
  "type": "object",
  "required": ["packageName", "timestamp", "total", "limit", "offset", "hasMore", "versions"],
  "properties": {
    "packageName": {
      "type": "string",
      "description": "Normalized package/product name (lowercase)"
    },
    "ecosystem": {
      "type": "string",
      "description": "Package ecosystem filter (npm, pypi, maven, rubygems, cargo, go, nuget, generic, unknown)",
      "enum": ["npm", "pypi", "maven", "rubygems", "cargo", "go", "nuget", "generic", "unknown"]
    },
    "timestamp": {
      "type": "integer",
      "description": "Unix timestamp when response was generated"
    },
    "total": {
      "type": "integer",
      "description": "Total number of versions before pagination",
      "minimum": 0
    },
    "limit": {
      "type": "integer",
      "description": "Maximum number of results per page",
      "minimum": 1,
      "maximum": 500
    },
    "offset": {
      "type": "integer",
      "description": "Number of results skipped",
      "minimum": 0
    },
    "hasMore": {
      "type": "boolean",
      "description": "Whether there are more results available"
    },
    "versions": {
      "type": "array",
      "description": "Array of version records for this package",
      "items": {
        "$ref": "#/definitions/VersionRecord"
      }
    }
  },
  "definitions": {
    "VersionRecord": {
      "type": "object",
      "required": ["version", "ecosystem", "sources"],
      "properties": {
        "version": {
          "type": "string",
          "description": "Specific version number or range"
        },
        "ecosystem": {
          "type": "string",
          "description": "Package ecosystem (npm, pypi, maven, etc.)",
          "enum": ["npm", "pypi", "maven", "rubygems", "cargo", "go", "nuget", "generic", "unknown"]
        },
        "sources": {
          "type": "array",
          "description": "Data sources that reference this version",
          "items": {
            "$ref": "#/definitions/SourceRecord"
          }
        },
        "cveIds": {
          "type": "array",
          "description": "CVE IDs affecting this version (optional, included in /vulns endpoint)",
          "items": {
            "type": "string",
            "pattern": "^(CVE-\\d{4}-\\d{4,}|GCVE-[A-Z]+-\\d{4}-\\d{4,}|GHSA-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{4}|PYSEC-\\d{4}-\\d+|MAL-\\d{4}-\\d+)$"
          }
        }
      }
    },
    "SourceRecord": {
      "type": "object",
      "required": ["sourceTable", "sourceId"],
      "properties": {
        "sourceTable": {
          "type": "string",
          "description": "Database table that references this package/version",
          "enum": [
            "github_repository",
            "cve_affected",
            "package_version",
            "dependency",
            "kev",
            "vulncheck_kev",
            "cve_metadata",
            "openssf_scorecard"
          ]
        },
        "sourceId": {
          "type": "string",
          "description": "Primary key or identifier in the source table"
        },
        "metadata": {
          "type": "object",
          "description": "Additional metadata specific to this source",
          "additionalProperties": true
        }
      }
    }
  },
  "examples": [
    {
      "packageName": "express",
      "ecosystem": "npm",
      "timestamp": 1700000000,
      "total": 523,
      "limit": 100,
      "offset": 0,
      "hasMore": true,
      "versions": [
        {
          "version": "4.18.2",
          "ecosystem": "npm",
          "sources": [
            {
              "sourceTable": "package_version",
              "sourceId": "uuid-123"
            },
            {
              "sourceTable": "github_repository",
              "sourceId": "12345"
            }
          ]
        },
        {
          "version": "4.17.1",
          "ecosystem": "npm",
          "sources": [
            {
              "sourceTable": "cve_affected",
              "sourceId": "uuid-456"
            }
          ],
          "cveIds": [
            "CVE-2024-1234",
            "CVE-2024-5678"
          ]
        }
      ]
    }
  ]
}
